% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bootstrap.R
\name{boot_pred_wild}
\alias{boot_pred_wild}
\title{Wild Bootstrap for Functional Quantile GAM}
\usage{
boot_pred_wild(
  d,
  B,
  seed,
  tau,
  X20,
  X80,
  model,
  multicore = TRUE,
  ncores = 3,
  verbose = TRUE
)
}
\arguments{
\item{d}{A data.frame used to fit the model. Must contain columns:
\describe{
\item{id}{Subject identifier (factor). Observations from the same subject
must share the same id.}
\item{y}{Response variable (numeric)}
\item{time}{Longitudinal time stamps (integer or numeric)}
\item{Xobs}{Matrix of functional covariate observations (n x S matrix,
where S is the number of functional grid points)}
\item{sMat}{Matrix of functional domain coordinates (n x S matrix)}
\item{tMat}{Matrix of longitudinal time coordinates (n x S matrix)}
}}

\item{B}{Integer. Number of bootstrap iterations. Battagliola et al. (2024)
use B = 100 in their application.}

\item{seed}{Integer. Random seed for reproducibility.}

\item{tau}{Numeric. Quantile level in (0,1). Should match the quantile
level used in the fitted model.}

\item{X20}{Numeric vector of length S. Point-wise lower reference curve
(e.g., 20\\% quantile of functional covariates).}

\item{X80}{Numeric vector of length S. Point-wise upper reference curve
(e.g., 80\\% quantile of functional covariates).}

\item{model}{A fitted \code{qgam} model object.}

\item{multicore}{Logical. If \code{TRUE}, uses parallel computation in
\code{qgam}. Default is \code{TRUE}.}

\item{ncores}{Integer. Number of cores for parallel computation.
Default is 3.}

\item{verbose}{Logical. If \code{TRUE}, prints progress messages.
Default is \code{TRUE}.}
}
\value{
A list of class \code{"fqgam_boot"} with components:
\describe{
\item{pred20}{Matrix (B x maxT) of predicted quantiles at each
longitudinal time for X20}
\item{pred80}{Matrix (B x maxT) of predicted quantiles at each
longitudinal time for X80}
\item{predDiff}{Matrix (B x maxT) of differences \eqn{\hat{Q}_{20}^\tau(t) - \hat{Q}_{80}^\tau(t)}}
\item{seed}{The random seed used}
\item{d}{The input data.frame}
\item{tau}{The quantile level}
\item{running_time}{Vector of execution times (in seconds) for each iteration}
\item{bootstrap_type}{"wild"}
}
}
\description{
Performs wild bootstrap inference for functional quantile regression models
fitted with \code{\link[qgam]{qgam}}. This method combines standard resampling
of estimated random effects with wild bootstrap of residuals, and is primarily
used for \strong{bias adjustment}.
}
\details{
\subsection{Purpose}{

Wild bootstrap is used for \strong{bias adjustment} of the quantile regression
estimators. As documented in Battagliola et al. (2022), estimators can be
severely biased when clusters are small due to the incidental parameter
problem, nonlinearity of quantiles, and penalization.
}

\subsection{Why Wild Bootstrap for Bias?}{

Block resampling cannot be used for bias adjustment because the target
parameter is not computable under the bootstrap distribution (the resampled
data do not have the same underlying parameters). Wild bootstrap generates
bootstrap data under a distribution where the true parameter equals the
estimate from observed data (\eqn{\hat{\beta}^\tau_{two-step}}), allowing
bias to be measured as the deviation between bootstrap estimates and the
original estimate.
}

\subsection{Algorithm}{

For each bootstrap iteration \eqn{b = 1, \ldots, B}:
\enumerate{
\item Extract estimated terms and residuals from the fitted model:
\itemize{
\item Residuals: \eqn{\varepsilon_{ij} = Y_{ij} - \hat{\alpha}^\tau(t_{ij}) - \int_S \hat{\beta}^\tau(s,t_{ij}) X_{ij}(s) ds - \hat{u}_i}
\item Estimated random effects: \eqn{\hat{u}_i} from subject-specific intercepts
}
\item Resample random effects \eqn{u_i^{*}} with replacement from \eqn{\{\hat{u}_1, \ldots, \hat{u}_N\}}
\item Generate wild bootstrap weights \eqn{w_{ij}} independently from:
\deqn{w = \begin{cases} 2(1-\tau) & \text{with probability } 1-\tau \\ -2\tau & \text{with probability } \tau \end{cases}}
This distribution has \eqn{\tau}-quantile equal to 0.
\item Create bootstrap responses:
\deqn{Y_{ij}^* = \hat{\alpha}^\tau(t_{ij}) + \int_S \hat{\beta}^\tau(s,t_{ij}) X_{ij}(s) ds + u_i^* + w_{ij} |\varepsilon_{ij}|}
\item Fit the model to \eqn{(Y_{ij}^*, X_{ij}, t_{ij})} and compute predictions
}
}

\subsection{Bias Estimation}{

The bias is estimated as:
\deqn{bias_{boot}(\hat{\theta}) = \frac{1}{B} \sum_{b=1}^{B} (\check{\theta}_b - \hat{\theta})}

where \eqn{\check{\theta}_b} are bootstrap estimates and \eqn{\hat{\theta}} is
the original estimate. The bias-adjusted estimator is:
\deqn{\hat{\theta}_{adj} = \hat{\theta} - bias_{boot}(\hat{\theta}) = 2\hat{\theta} - \bar{\theta}^*}
}

\subsection{Wild Bootstrap Properties}{

The wild bootstrap with asymmetric weights was proposed by Feng et al. (2011)
for quantile regression. As noted by Wang et al. (2018), wild bootstrap captures
asymmetry and heteroscedasticity better than ordinary resampling of residuals.
}

\subsection{Important Notes}{

\itemize{
\item Covariates \eqn{X_{ij}} and time points \eqn{t_{ij}} are kept fixed
(same as in the original data)
\item The coupling between covariates and residuals is maintained
\item This method may underestimate variance due to shrinkage of predicted
random effects; use \code{\link{boot_pred_block}} for variance estimation
}
}
}
\examples{
\dontrun{
library(refund)
library(qgam)

# (Data preparation as in boot_pred_block example)

# Run wild bootstrap for bias adjustment
wb <- boot_pred_wild(myDataFit, B = 100, seed = 4321, tau = tau,
                     X20 = cca20, X80 = cca80, model = fit)

# Compute bias-adjusted estimates
# Original prediction difference
predDiff_original <- ... # computed from original fit

# Bias estimation
diff_adj <- sweep(wb$predDiff, 2, predDiff_original)
bias <- colMeans(diff_adj)

# Bias-adjusted prediction
predDiff_adjusted <- predDiff_original - bias
}

}
\references{
Battagliola, M.L., Sorensen, H., Tolver, A., & Staicu, A.-M. (2024).
Quantile regression for longitudinal functional data with application to
feed intake of lactating sows. Journal of Agricultural, Biological, and
Environmental Statistics, 30(1), 211-230.

Battagliola, M.L., Sorensen, H., Tolver, A., & Staicu, A.-M. (2022).
A bias-adjusted estimator in quantile regression for clustered data.
Econometrics and Statistics, 23, 165-186.

Feng, X., He, X., & Hu, J. (2011). Wild bootstrap for quantile regression.
Biometrika, 98(4), 995-999.

Wang, L., Van Keilegom, I., & Maidman, A. (2018). Wild residual bootstrap
inference for penalized quantile regression with heteroscedastic errors.
Biometrika, 105(4), 859-872.
}
\seealso{
\code{\link{boot_pred_block}} for block bootstrap (variance estimation),
\code{\link{boot_ci}} for computing confidence intervals,
\code{\link{compute_bias_adjustment}} for computing bias-adjusted estimates
}
